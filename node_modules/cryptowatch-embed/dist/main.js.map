{"version":3,"sources":["../src/main.js"],"names":["validTimePeriods","validLocales","requiredColorSchemeKeys","queryToString","query","pairs","key","push","length","join","Embed","exchange","currencyPair","opts","undefined","Error","timePeriod","toLowerCase","indexOf","locale","host","protocol","width","height","iframe","document","createElement","setAttribute","src","elem","querySelector","appendChild","createIframe","path","uri","presetColorScheme","customColorScheme","encodeURIComponent","JSON","stringify"],"mappings":"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","file":"main.js","sourcesContent":["const validTimePeriods = [\n  '1m', '3m', '5m', '15m', '30m', '1h', '2h', '4h', '6h', '12h', '1d', '3d', '1w'\n]\n\nconst validLocales = [\n  'en', 'es', 'zh-CN', 'de', 'ja-JP', 'el-GR', 'da-DK'\n]\n\nconst requiredColorSchemeKeys = [\n    'bg', 'text', 'textStrong', 'textWeak', 'short', 'shortFill', 'long', 'longFill', 'cta', 'ctaHighlight', 'alert'\n]\n\nfunction queryToString(query) {\n  let pairs = [];\n  for (let key in query) {\n    pairs.push(`${key}=${query[key]}`);\n  }\n\n  if (pairs.length === 0) {\n    return '';\n  } else {\n    return '?'+pairs.join('&');\n  }\n}\n\nclass Embed {\n  constructor(exchange, currencyPair, opts={}) {\n    this.exchange = exchange;\n    this.currencyPair = currencyPair;\n    this.opts = opts;\n\n    // Validate exchange\n    if (exchange === undefined) {\n      throw new Error('exchange required');\n    }\n\n    // Validate currencyPair\n    if (currencyPair === undefined) {\n      throw new Error('currencyPair required');\n    }\n    // TODO validate that exchange supports this currencyPair (generated config)\n    // As this is now, it will just render an iframe containing the 404 page\n\n    if (opts.timePeriod !== undefined && (typeof opts.timePeriod) === 'string') {\n      opts.timePeriod = opts.timePeriod.toLowerCase();\n      if (validTimePeriods.indexOf(opts.timePeriod) === -1) {\n        throw new Error(`Unknown time period \"${opts.timePeriod}\"\\nValid timePeriods: ${validTimePeriods.join(', ')}`);\n      }\n      opts.timePeriod = opts.timePeriod.toLowerCase();\n    } else {\n      opts.timePeriod = null; // Will load last selected for returning users, or default (1H) for new users\n    }\n\n    if (opts.locale !== undefined) {\n      if (validLocales.indexOf(opts.locale) === -1) {\n        throw new Error(`Unknown locale \"${opts.locale}\"\\nValid locales: ${validLocales.join(', ')}`);\n      }\n    }\n\n    if (opts.host === undefined) opts.host = 'embed.cryptowat.ch';\n    if (opts.protocol === undefined) opts.protocol = 'https';\n    if (opts.width === undefined) opts.width = '100%';\n    if (opts.height === undefined) opts.height = '100%';\n  }\n\n  get src() {\n    let path = `/${this.exchange}/${this.currencyPair}`;\n    if (this.opts.timePeriod !== null) {\n      path += `/${this.opts.timePeriod}`;\n    }\n\n    let uri = `${this.opts.protocol}://${this.opts.host}${path}`;\n    let query = {}\n    if (this.opts.locale) {\n      query.locale = this.opts.locale;\n    }\n    if (this.opts.query) {\n      // Extend query with additional params that may have been added\n      for (let key in this.opts.query) {\n        if (query[key] === undefined) query[key] = this.opts.query[key];\n      }\n    }\n\n    if (this.opts.presetColorScheme !== undefined) {\n      query.presetColorScheme = this.opts.presetColorScheme;\n    } else if (this.opts.customColorScheme !== undefined) {\n      query.customColorScheme = encodeURIComponent(JSON.stringify(this.opts.customColorScheme));\n    }\n\n    uri += queryToString(query);\n    return uri;\n  }\n\n  createIframe() {\n    let iframe = document.createElement('iframe');\n    iframe.setAttribute('src', this.src);\n    iframe.setAttribute('frameborder', 0);\n    iframe.setAttribute('allowfullscreen', true);\n    iframe.setAttribute('width', this.opts.width);\n    iframe.setAttribute('height', this.opts.height);\n\n    return iframe;\n  }\n\n  mount(elem) {\n    if (typeof elem === 'string') {\n      elem = document.querySelector(elem);\n    }\n    elem.appendChild(this.createIframe());\n  }\n}\n\nexport default Embed;\n"]}